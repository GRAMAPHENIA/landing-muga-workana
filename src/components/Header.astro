---
import { siteConfig } from '../config/site';
import Button from './Button.astro';
---

<style>
  /* Solo mantener estilos que realmente se usan */
</style>

<header
  class="header-critical fixed top-0 left-0 w-full z-50 bg-white/95 backdrop-blur-sm border-b border-neutral-200"
>
  <div class="container">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2" aria-label="Inicio">
        <span class="text-2xl font-bold text-neutral-700"
          >{siteConfig.name}</span
        >
      </a>

      <!-- Navegación Desktop -->
      <nav class="hidden md:flex items-center space-x-8" role="navigation" aria-label="Navegación principal">
        {
          siteConfig.navigation.map(item => (
            <a href={item.href} class="text-neutral-700 hover:text-neutral-900 transition-colors">
              {item.name}
            </a>
          ))
        }
      </nav>

      <!-- CTA Button -->
      <div class="hidden md:block">
        <Button href="#contacto" variant="outline"> Contactar </Button>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="md:hidden p-2 rounded-lg hover:bg-neutral-100 transition-colors duration-200"
        aria-label="Abrir menú"
        aria-expanded="false"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path id="menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          <path id="close-icon" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Menu Overlay - Simplificado -->
<div
  id="mobile-menu-overlay"
  class="fixed inset-0 z-40 md:hidden opacity-0 invisible transition-all duration-300 ease-in-out"
  role="dialog"
  aria-modal="true"
  aria-labelledby="mobile-menu-title"
>
  <!-- Backdrop -->
  <div class="absolute inset-0 bg-black/20 backdrop-blur-sm" id="mobile-menu-backdrop"></div>

  <!-- Sidebar -->
  <div
    id="mobile-menu-sidebar"
    class="absolute right-0 top-0 h-full w-80 max-w-[85vw] bg-white shadow-xl transform transition-transform duration-300 ease-out"
    style="transform: translateX(100%)"
  >
    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b border-neutral-200">
      <span id="mobile-menu-title" class="text-xl font-bold text-neutral-700">{siteConfig.name}</span>
      <button id="mobile-menu-close" class="p-2 rounded-lg hover:bg-neutral-100" aria-label="Cerrar menú">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <!-- Navigation -->
    <nav class="p-6" role="navigation" aria-label="Navegación móvil">
      {
        siteConfig.navigation.map(item => (
          <a
            href={item.href}
            class="block py-3 px-4 text-lg font-medium text-neutral-700 hover:bg-neutral-100 rounded-lg transition-colors"
          >
            {item.name}
          </a>
        ))
      }
      <div class="mt-6">
        <Button href="#contacto" variant="primary" class="w-full">
          Contactar
        </Button>
      </div>
    </nav>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
    const mobileMenuSidebar = document.getElementById('mobile-menu-sidebar');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    let isMenuOpen = false;

    // Abrir menú
    const openMenu = () => {
      if (isMenuOpen) return;
      isMenuOpen = true;
      
      document.body.style.overflow = 'hidden';
      mobileMenuButton?.setAttribute('aria-expanded', 'true');
      
      // Cambiar icono
      menuIcon?.classList.add('hidden');
      closeIcon?.classList.remove('hidden');

      // Mostrar overlay
      mobileMenuOverlay?.classList.remove('opacity-0', 'invisible');
      mobileMenuOverlay?.classList.add('opacity-100', 'visible');

      // Animar sidebar
      requestAnimationFrame(() => {
        if (mobileMenuSidebar) {
          mobileMenuSidebar.style.transform = 'translateX(0)';
        }
      });
    };

    // Cerrar menú
    const closeMenu = () => {
      if (!isMenuOpen) return;
      isMenuOpen = false;

      document.body.style.overflow = '';
      mobileMenuButton?.setAttribute('aria-expanded', 'false');
      
      // Cambiar icono
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');

      // Animar sidebar
      if (mobileMenuSidebar) {
        mobileMenuSidebar.style.transform = 'translateX(100%)';
      }

      // Ocultar overlay
      setTimeout(() => {
        mobileMenuOverlay?.classList.remove('opacity-100', 'visible');
        mobileMenuOverlay?.classList.add('opacity-0', 'invisible');
      }, 300);
    };

    // Event listeners
    mobileMenuButton?.addEventListener('click', () => isMenuOpen ? closeMenu() : openMenu());
    mobileMenuClose?.addEventListener('click', closeMenu);
    mobileMenuBackdrop?.addEventListener('click', closeMenu);

    // Cerrar con enlaces
    document.querySelectorAll('#mobile-menu-sidebar a').forEach(link => {
      link.addEventListener('click', () => setTimeout(closeMenu, 100));
    });

    // Cerrar con Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isMenuOpen) closeMenu();
    });

    // Cerrar en desktop
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 768 && isMenuOpen) closeMenu();
    });
  });
</script>
